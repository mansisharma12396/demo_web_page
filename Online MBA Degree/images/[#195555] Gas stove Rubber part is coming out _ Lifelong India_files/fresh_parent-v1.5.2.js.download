(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_utils=require('../lib/utils.js'),utils=_interopRequireWildcard(_utils),_configs=require('../lib/configs.js'),configs=_interopRequireWildcard(_configs),_agentOauth=require('../lib/agent-oauth.js'),agentOAuth=_interopRequireWildcard(_agentOauth);function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var CUSTOM_IPARAM_API='CustomIparamAPI',CUSTOM_IPARAM='custom_iparam',SET_CONFIGS='getConfigs',AppInstance=function(){function a(b,c,d,e){var f=this;return _classCallCheck(this,a),_extends(this,b),this.location=c,this.appDetails=b,this.instanceId=utils.generateId(),this.product=e.product,this.locationDetails=e.locations[this.location],this.appMgrConfigs=configs.initialize(e),this.listens=['app.activated','app.deactivated'],this.intercepts=[],this.services=_extends({},d),this.handshakePromise=new e.Promise(function(a,b){f.handshake={resolve:a,reject:b}}),this.constructIframe()}return _createClass(a,[{key:'postMessage',value:function b(a){this.channel.port1.postMessage(utils.default.stringify(a))}},{key:'getContext',value:function a(){return{product:this.product}}},{key:'getAppContext',value:function a(){return{app:this}}},{key:'isCustomIparam',value:function a(){return this.location===CUSTOM_IPARAM}},{key:'onMessage',value:function d(a){var b=this;if('iframe:loaded'===a.data.type)return this.handshake.resolve(),this.isCustomIparam()?this.services[CUSTOM_IPARAM_API].process({method:SET_CONFIGS,options:{configs:this.configs,productConfigs:this.productConfigs,isInstall:this.isInstall}},this.getAppContext()):void 0;if('EventAPI'===a.data.service)return this.services[a.data.service].process(a.data,this.getAppContext());if(a.data.service===CUSTOM_IPARAM_API)return this.services[a.data.service].responseHandler(a.data);var c={service:a.data.service,uniqId:a.data.uniqId};this.services[a.data.service].process(a.data,this.getAppContext()).then(function(a){c.respData=a,b.postMessage(c)}).catch(function(a){c.error=a,b.postMessage(c)})}},{key:'initializeChannel',value:function b(){var a=this;this.channel=new MessageChannel,this.channel.port1.onmessage=function(b){return a.onMessage(b)}}},{key:'getSourceURL',value:function b(){// Return the App URL for Non-AgentOAuth app and AgentOAuth app with Tokens
if(this.isCustomIparam()||!agentOAuth.isAgentOAuthApp(this.appDetails)||agentOAuth.hasOAuthTokens(this.appDetails))return this.url;// Show AgentOAuth template
var a={versionId:this.appDetails.versionId,product:this.product};// Show AgentOAuth PopUp
return this.locationDetails.hasViewport||(a.showPopup=!0),agentOAuth.getOAuthSrc(this.appDetails,this.appMgrConfigs)+'?'+function b(a){return Object.keys(a).map(function(b){return[].concat(b+'='+encodeURIComponent(a[b])).join('&')}).join('&')}(a)}},{key:'constructIframe',value:function c(){var a=this,b=document.createElement('iframe');return b.sandbox='allow-scripts allow-forms allow-same-origin allow-popups allow-modals',b.allow='geolocation; microphone',b.id=this.instanceId,b.src=this.getSourceURL(),b.addEventListener('load',function(){a.initializeChannel(),b.contentWindow.postMessage({type:'iframe:handshake',instanceId:a.instanceId,services:Object.keys(a.services),context:a.getContext()},'*',[a.channel.port2])}),this.element=b,{id:this.id,element:this.element,appInstance:this,iconURL:this.iconURL,location:this.location,displayName:this.displayName,trigger:function c(b){return'custom_iparam.submit'===b.type?a.submitCustomIparam():a.triggerAppEvent(b)}}}},{key:'triggerAppEvent',value:function c(a){var b=this;return this.handshakePromise.then(function(){return b.services.EventAPI.route(a,[b])})}/*
  Invoke methods in custom installation page and return back the response.
  */},{key:'submitCustomIparam',value:function c(){var a=this,b=this.services[CUSTOM_IPARAM_API];return b.process({method:'validate'},this.getAppContext()).then(function(){return b.process({method:'postConfigs'},a.getAppContext())})}}]),a}();/* Invoke getConfigs() method of custom installation page to set
   the saved configs in custom installtion page.
*/exports.default=AppInstance;

},{"../lib/agent-oauth.js":4,"../lib/configs.js":5,"../lib/utils.js":6}],2:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.MarketplaceManager=void 0;var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_utils=require('../lib/utils.js'),utils=_interopRequireWildcard(_utils),_configs=require('../lib/configs.js'),configs=_interopRequireWildcard(_configs),_agentOauth=require('../lib/agent-oauth.js'),agentOAuth=_interopRequireWildcard(_agentOauth),_appInstance=require('./app-instance.js'),_appInstance2=_interopRequireDefault(_appInstance),_data=require('../services/data.js'),_data2=_interopRequireDefault(_data),_event=require('../services/event.js'),_event2=_interopRequireDefault(_event),_iparam=require('../services/iparam.js'),_iparam2=_interopRequireDefault(_iparam),_request=require('../services/request.js'),_request2=_interopRequireDefault(_request),_instance=require('../services/instance.js'),_instance2=_interopRequireDefault(_instance),_interface=require('../services/interface.js'),_interface2=_interopRequireDefault(_interface),_datastore=require('../services/datastore.js'),_datastore2=_interopRequireDefault(_datastore),_customIparam=require('../services/custom-iparam.js'),_customIparam2=_interopRequireDefault(_customIparam);// !!!FORGOT ABOUT THE APP UNLOAD EVENT!!!
function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var SERVICES={DataAPI:_data2.default,EventAPI:_event2.default,IparamAPI:_iparam2.default,RequestAPI:_request2.default,InstanceAPI:_instance2.default,InterfaceAPI:_interface2.default,DataStoreAPI:_datastore2.default,CustomIparamAPI:_customIparam2.default},CUSTOM_IPARAM='custom_iparam',MarketplaceManager=exports.MarketplaceManager=function(){function a(b){var c=this;_classCallCheck(this,a),utils.validate('MarketplaceManager.adapter',b),this.configs=configs.initialize(b),this.services={},this.isDev=-1!==window.location.search.indexOf('dev=true'),this.adapter=b,this.adapter.instances=[],Object.keys(SERVICES).forEach(function(a){c.services[a]=new SERVICES[a](c.adapter)});return(window.addEventListener('message',function b(a){return agentOAuth.onMessage(a,c.adapter,c.configs)},!1),this.adapter.page===CUSTOM_IPARAM)?{createInstance:function e(a){var b=utils.pick(c.services,function(a,b){return!b.isProductAPI}),d=new _appInstance2.default(_extends({},a,{url:a.locations[CUSTOM_IPARAM].url,iconURL:a.locations[CUSTOM_IPARAM].icon_url,productConfigs:c.adapter.productConfigs,isInstall:c.adapter.isInstall}),CUSTOM_IPARAM,b,{product:c.adapter.product,Promise:c.adapter.Promise,locations:c.adapter.locations});return c.adapter.instances.push(d.appInstance),d}}:(this.appDetails=this.adapter.Promise.all([this.makeCall(),this.makeCall(!0)]).then(utils.flattenArray),{getApps:function b(a){return c.getApps(a)},trigger:function b(a){return c.services.EventAPI.route(a)}})}return _createClass(a,[{key:'getApps',value:function d(a){var c=this;function b(b){return-1!==Object.keys(b.locations).indexOf(a.location)}if(!this.adapter.locations.hasOwnProperty(a.location))return this.adapter.Promise.resolve([]);return this.appDetails.then(function h(d){var e,f=utils.pick(c.services,function(b,d){return!d.isProductAPI||-1!==c.adapter.locations[a.location].services.indexOf(b)}),g=d.filter(b).sort(a.sorter).map(function(b){return new _appInstance2.default(_extends({},b,{url:b.locations[a.location].url,iconURL:b.locations[a.location].icon_url}),a.location,f,{product:c.adapter.product,Promise:c.adapter.Promise,locations:c.adapter.locations})});// Ugly.
// eslint-disable-next-line max-len
// Don't like the mapping here :(
return(e=c.adapter.instances).push.apply(e,_toConsumableArray(g.map(function(a){return a.appInstance}))),g})}// weird name
},{key:'makeCall',value:function c(a){var b=this;if(a&&!this.isDev)return[];/**
     *  This ajax call NEVER rejects. If there is any issue with fetching apps
     *  one can always look at the network panel in the browser.
     */return this.adapter.ajax({method:'GET',headers:{"MKP-APIKEY":this.adapter.apiKey,accept:'application/json',"X-CSRF-TOKEN":this.adapter.csrfToken,"MKP-AUTH-TOKEN":this.adapter.authToken},url:a?this.configs.urls.LOCAL_APP_LIST:this.configs.urls.APP_LIST}).then(function d(c){// TODO: features and all the oring should be removed
return a&&(c=utils.normalizeCLIResponse(c,b.adapter.product),b.adapter.interface({method:'showNotify',options:{message:'FDK serving local app "'+c.map(function(a){return a.displayName})+'"',type:'info'}})),c.map(function(b){return{id:b.id,isLocal:!!a,features:b.features,versionId:b.version_id,configs:b.configs||{},locations:b.placeholders||{},displayName:b.displayName||b.display_name,authorizeUrl:b.authorizeUrl||b.authorize_url}})},function a(){return[]})}}]),a}();

},{"../lib/agent-oauth.js":4,"../lib/configs.js":5,"../lib/utils.js":6,"../services/custom-iparam.js":7,"../services/data.js":8,"../services/datastore.js":9,"../services/event.js":11,"../services/instance.js":12,"../services/interface.js":13,"../services/iparam.js":14,"../services/request.js":15,"./app-instance.js":1}],3:[function(require,module,exports){
'use strict';var _manager=require('./app/manager.js'),_eventReceiver=require('./services/event-receiver.js'),_eventReceiver2=_interopRequireDefault(_eventReceiver);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var Manager=function a(b){return _classCallCheck(this,a),'galleryEventExchange'===b.type?new _eventReceiver2.default(b):new _manager.MarketplaceManager(b)};window.MarketplaceManager=Manager;

},{"./app/manager.js":2,"./services/event-receiver.js":10}],4:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.onMessage=exports.getOAuthSrc=exports.clearOAuthTokens=exports.getAuthorizeUrl=exports.hasOAuthTokens=exports.setOAuthTokens=exports.getOAuthTokens=exports.isAgentOAuthApp=void 0;var _utils=require('../lib/utils.js'),_utils2=_interopRequireDefault(_utils);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var ACTIVATE_TIMEOUT=1e3;function isAgentOAuthApp(a){return -1!==a.features.indexOf('agent_oauth')}function getKey(a){return'app_'+a.id+'_'+a.versionId}function getOAuthTokens(a){return _utils2.default.parse(window.localStorage.getItem(getKey(a)))||{}}function hasOAuthTokens(a){return 0<Object.keys(getOAuthTokens(a)).length}function setOAuthTokens(a,b){return window.localStorage.setItem(getKey(a),_utils2.default.stringify(b))}function clearOAuthTokens(a){window.localStorage.removeItem(getKey(a))}function getAuthorizeUrl(a,b){return a.isLocal?b.urls.LOCAL_OAUTH_URL:a.authorizeUrl}function getOAuthSrc(a,b){return a.isLocal?b.urls.LOCAL_AGENT_OAUTH_HTML:b.urls.AGENT_OAUTH_HTML}function onMessage(a,b,c){var d=b.instances.filter(function(b){return b.versionId===+a.data.versionId});return function b(){return'agent_oauth_handshake'===a.data.type&&0<d.length}()?a.data.hasOwnProperty('error')?function c(){return b.interface({method:'showNotify',options:{message:a.data.error.message,type:'danger'}})}(a):'authorize'===a.data.method?function a(){return window.open(getAuthorizeUrl(d[0],c),'','height=600,width=800')}(a):void(a.data.hasOwnProperty('tokens')&&function c(){var b=d[0];return setOAuthTokens(b,{tokens:a.data.tokens}),d.forEach(function(a){a.element.src=a.getSourceURL(),setTimeout(function(){a.triggerAppEvent({type:'app.activated'})},ACTIVATE_TIMEOUT)})}(a)):void 0}exports.isAgentOAuthApp=isAgentOAuthApp,exports.getOAuthTokens=getOAuthTokens,exports.setOAuthTokens=setOAuthTokens,exports.hasOAuthTokens=hasOAuthTokens,exports.getAuthorizeUrl=getAuthorizeUrl,exports.clearOAuthTokens=clearOAuthTokens,exports.getOAuthSrc=getOAuthSrc,exports.onMessage=onMessage;

},{"../lib/utils.js":6}],5:[function(require,module,exports){
'use strict';var CONFIGS={freshdesk:function b(a){return{urls:{APP_LIST:a.domain+'/api/_/marketplace_apps',DATA_PIPE:a.domain+'/mkp/data-pipe.json',LOCAL_APP_LIST:'http://localhost:10001/iframe/api?product='+a.product,LOCAL_DATA_PIPE:'http://localhost:10001/dprouter',LOCAL_OAUTH_REDIRECT:'http://localhost:10001/auth/index?callback='+document.URL,AGENT_OAUTH_HTML:'https://dl.freshdev.io/oauth/agent_oauth.html',LOCAL_AGENT_OAUTH_HTML:'http://dl.freshdev.io/oauth/agent_oauth.html',LOCAL_OAUTH_URL:'http://localhost:10001/auth/index'},timeouts:{PROXY:12e3,DATA:5e3,SMI:6500}}},freshservice:function b(a){return{urls:{APP_LIST:a.domain+'/api/_/marketplace_apps',DATA_PIPE:a.domain+'/mkp/data-pipe.json',LOCAL_APP_LIST:'http://localhost:10001/iframe/api?product='+a.product,LOCAL_DATA_PIPE:'http://localhost:10001/dprouter',LOCAL_OAUTH_REDIRECT:'http://localhost:10001/auth/index?callback='+document.URL,AGENT_OAUTH_HTML:'https://dl.freshdev.io/oauth/agent_oauth.html',LOCAL_AGENT_OAUTH_HTML:'http://dl.freshdev.io/oauth/agent_oauth.html',LOCAL_OAUTH_URL:'http://localhost:10001/auth/index'},timeouts:{PROXY:12e3,DATA:5e3,SMI:6500}}},freshsales:function b(a){return{urls:{APP_LIST:a.domain+'/marketplace_apps',DATA_PIPE:a.domain+'/mkp/data-pipe.json',LOCAL_APP_LIST:'http://localhost:10001/iframe/api?product='+a.product,LOCAL_DATA_PIPE:'http://localhost:10001/dprouter',LOCAL_OAUTH_REDIRECT:'http://localhost:10001/auth/index?callback='+document.URL,AGENT_OAUTH_HTML:'https://dl.freshdev.io/oauth/agent_oauth.html',LOCAL_AGENT_OAUTH_HTML:'http://dl.freshdev.io/oauth/agent_oauth.html',LOCAL_OAUTH_URL:'http://localhost:10001/auth/index'},timeouts:{PROXY:12e3,DATA:5e3,SMI:6500}}},mags:function b(a){return{urls:{DATA_PIPE:a.domain+'/data-pipe',LOCAL_DATA_PIPE:'http://localhost:10001/dprouter'},timeouts:{PROXY:12e3,DATA:5e3,SMI:6500}}},freshchat:function b(a){return{urls:{APP_LIST:'https://marketplace-'+a.region+'.freshworks.com/api/v1/installations?product='+a.product+'&account='+a.accountID+'&detailed=true&type=1,4,6&enabled=true',DATA_PIPE:'https://marketplace-'+a.region+'.freshworks.com/platform',LOCAL_APP_LIST:'http://localhost:10001/iframe/api?product='+a.product,LOCAL_DATA_PIPE:'http://localhost:10001/dprouter',LOCAL_OAUTH_REDIRECT:'http://localhost:10001/auth/index?callback='+document.URL,AGENT_OAUTH_HTML:'https://dl.freshdev.io/oauth/agent_oauth.html',LOCAL_AGENT_OAUTH_HTML:'http://dl.freshdev.io/oauth/agent_oauth.html',LOCAL_OAUTH_URL:'http://localhost:10001/auth/index'},timeouts:{PROXY:12e3,DATA:5e3,SMI:6500}}},freshcaller:function b(a){return{urls:{APP_LIST:'https://marketplace-'+a.region+'.freshworks.com/api/v1/installations?product='+a.product+'&account='+a.accountID+'&detailed=true&type=1,4,6&enabled=true',DATA_PIPE:'https://marketplace-'+a.region+'.freshworks.com/platform',LOCAL_APP_LIST:'http://localhost:10001/iframe/api?product='+a.product,LOCAL_DATA_PIPE:'http://localhost:10001/dprouter',LOCAL_OAUTH_REDIRECT:'http://localhost:10001/auth/index?callback='+document.URL,AGENT_OAUTH_HTML:'https://dl.freshdev.io/oauth/agent_oauth.html',LOCAL_AGENT_OAUTH_HTML:'http://dl.freshdev.io/oauth/agent_oauth.html',LOCAL_OAUTH_URL:'http://localhost:10001/auth/index'},timeouts:{PROXY:12e3,DATA:5e3,SMI:6500}}},freshconnect:function b(a){return{urls:{APP_LIST:'https://marketplace-'+a.region+'.freshworks.com/api/v1/installations?product='+a.product+'&account='+a.accountID+'&detailed=true&type=1,4,6&enabled=true',DATA_PIPE:'https://marketplace-'+a.region+'.freshworks.com/platform',LOCAL_APP_LIST:'http://localhost:10001/iframe/api?product='+a.product,LOCAL_DATA_PIPE:'http://localhost:10001/dprouter',LOCAL_OAUTH_REDIRECT:'http://localhost:10001/auth/index?callback='+document.URL,AGENT_OAUTH_HTML:'https://dl.freshdev.io/oauth/agent_oauth.html',LOCAL_AGENT_OAUTH_HTML:'http://dl.freshdev.io/oauth/agent_oauth.html',LOCAL_OAUTH_URL:'http://localhost:10001/auth/index'},timeouts:{PROXY:12e3,DATA:5e3,SMI:6500}}}};/**
 *  `initialize` is a function so that we can have any
 *   complex conditions in the future if needed.
 */function initialize(a){var b=a.product;if(!CONFIGS.hasOwnProperty(b))throw new Error('Unsupported product "'+b+'"');return CONFIGS[b](a)}module.exports={initialize:initialize};

},{}],6:[function(require,module,exports){
'use strict';var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};Object.defineProperty(exports,'__esModule',{value:!0});exports.generateId=generateId,exports.validate=validate,exports.pick=pick,exports.flattenArray=flattenArray,exports.removeElement=removeElement,exports.addElement=addElement,exports.normalizeCLIResponse=normalizeCLIResponse;function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var KNOWN_ENTITIES={"MarketplaceManager.adapter":['Promise','ajax','page','product','locations','accountID','domain'],"EventReceiver.adapter":['iframeId','type','eventHandler']},LOCAL_APP_ID=123456789;function generateId(){return Math.floor(Date.now()*Math.random()).toString(36)}function validate(a,b){if(!KNOWN_ENTITIES.hasOwnProperty(a))throw new Error('Unknown entity "'+a+'"');if(!b)throw new Error('Invalid adapter object "'+JSON.stringify(b)+'"');KNOWN_ENTITIES[a].forEach(function(c){if(!b.hasOwnProperty(c))throw new Error('Expected "'+a+'" to contain "'+c+'"')})}function pick(a,b){// Array.prototype.reduce is broken in Freshservice.
return Object.keys(a).filter(function(c){return b(c,a[c])}).reduceRight(function(b,c){return _extends({},b,_defineProperty({},c,a[c]))},{})}function flattenArray(b){return Array.prototype.concat.apply([],b)}function removeElement(a,b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)}function addElement(a,b){-1!==a.indexOf(b)||a.push(b)}function normalizeCLIResponse(a,b){function c(a,b){Object.keys(a).forEach(function(c){var d=a[c];d.url='http://localhost:10001/iframe/'+(b||d.url),d.icon_url='http://localhost:10001/iframe/'+d.icon})}if(!a.product[b])return[];var d=a.product[b].location,e={id:LOCAL_APP_ID,version_id:LOCAL_APP_ID,configs:a.configs,features:a.features,displayName:a.displayName,placeholders:d};/**
   *  DO NOT replace the below predicate with !shorthand.
   *  Look at the CLI's response to understand why.
   */return!1===a.isAuthorized?c(e.placeholders,'oauth/local-testing-oauth-msg.html'):c(e.placeholders),[e]}/**
 *  Unfortunately, different Freshworks products have broken JSON.stringify in
 *  different ways (mostly by using PrototypeJS). To make sure that we stringify
 *  objects properly, we have this check to delegate to different functions based
 *  on the environment we are in.
 */function getStringify(){return window.Prototype?Object.toJSON||JSON.stringify:JSON.stringify}exports.default={stringify:getStringify(),parse:JSON.parse};

},{}],7:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_utils=require('../lib/utils.js'),utils=_interopRequireWildcard(_utils);function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var TIMEOUT_ERROR='Request timed out!',INVALID_METHOD='Invalid method provided.',UNEXPECTED_RESPONSE='Received unexpected response from client',VALID_METHODS=['getConfigs','postConfigs','validate'],SERVICE='CustomIparamAPI',VALIDATE='validate',TIMEOUT=3e3,CustomIparamAPI=function(){function a(b){_classCallCheck(this,a),this.adapter=b,this.requests={}}/*
  Product invoke this method for custom installation page.
  Post request to the child and returns a promise to the product.
  */return _createClass(a,[{key:'process',value:function e(a,b){var c=this;if(0>VALID_METHODS.indexOf(a.method))return this.adapter.Promise.reject(INVALID_METHOD);var d=_extends({},a,{service:SERVICE,uniqId:utils.generateId(),instanceId:b.app.instanceId});return new this.adapter.Promise(function(a,e){c.requests[d.uniqId]={resolve:a,reject:e},c.gc(d.uniqId),b.app.postMessage(d)})}/*
  Handler for the response from the client. Verify the response is for a valid request.
  Resolves/Rejects the promise accordingly.
  */},{key:'responseHandler',value:function c(a){function b(){return a.method!==VALIDATE||a.respData.hasOwnProperty('isValid')&&a.respData.isValid}if(this.requests[a.uniqId]){var d=this.requests[a.uniqId];return delete this.requests[a.uniqId],a.respData?b()?d.resolve(a.respData):d.reject(a.respData):d.reject({method:a.method,error:a.error})}// eslint-disable-next-line no-console
return console.error('CustomIparamAPI - Received unexpected response from client',a)}/*
  Garbage collector clears the pending request once it expires.
  */},{key:'gc',value:function c(a){var b=this;setTimeout(function(){b.requests[a]&&(b.requests[a].reject({message:TIMEOUT_ERROR}),delete b.requests[a])},TIMEOUT)}}]),a}();// in milliseconds
exports.default=CustomIparamAPI;

},{"../lib/utils.js":6}],8:[function(require,module,exports){
"use strict";var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(exports,"__esModule",{value:!0});function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var DataAPI=function(){function a(b){_classCallCheck(this,a),this.adapter=b,this.isProductAPI=!0}return _createClass(a,[{key:"process",value:function b(a){return this.adapter.getAttribute(a.options.attribute)}}]),a}();exports.default=DataAPI;

},{}],9:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_utils=require('../lib/utils.js'),_utils2=_interopRequireDefault(_utils),_configs=require('../lib/configs.js'),configs=_interopRequireWildcard(_configs);function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var DatastoreAPI=function(){function a(b){_classCallCheck(this,a),this.adapter=b,this.configs=configs.initialize(b)}return _createClass(a,[{key:'process',value:function f(a,b){var c=this,d=b.app.isLocal?this.configs.urls.LOCAL_DATA_PIPE:this.configs.urls.DATA_PIPE,e=_extends({},a.options,{action:a.method});return this.adapter.ajax({url:d,type:'POST',timeout:this.configs.timeouts.DATA,data:_utils2.default.stringify(e),headers:{"MKP-APIKEY":this.adapter.apiKey,"MKP-AUTH-TOKEN":this.adapter.authToken,"X-CSRF-TOKEN":this.adapter.csrfToken,"content-type":'application/json',"MKP-EXTNID":b.app.id,"MKP-VERSIONID":b.app.versionId,"MKP-ROUTE":'db'}}).then(function(a){return c.adapter.Promise.resolve(a)},// Why Parse?
function(a){return c.adapter.Promise.reject(_utils2.default.parse(a.responseText))})}}]),a}();exports.default=DatastoreAPI;

},{"../lib/configs.js":5,"../lib/utils.js":6}],10:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_utils=require('../lib/utils.js'),utils=_interopRequireWildcard(_utils);function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var GalleryEventReceiver=function(){/**
   * @param {object} adapter
   * @property {function} eventHandler
  */function a(b){_classCallCheck(this,a),utils.validate('EventReceiver.adapter',b),this.iframeId=b.iframeId,this.eventHandler='function'==typeof b.eventHandler?b.eventHandler:null,this.initialize()}return _createClass(a,[{key:'setupChannel',value:function a(){this.channel||(this.channel=new MessageChannel,this.port=this.channel.port1,this.eventSource.contentWindow.postMessage('galleryIframe:port','*',[this.channel.port2]),this.port.addEventListener('message',this.onMessage.bind(this),!1),this.port.start())}},{key:'initialize',value:function b(){var a=this;this.eventSource=document.getElementById(this.iframeId),this.eventSource&&this.eventSource.addEventListener&&this.eventSource.addEventListener('load',function(){a.setupChannel()})}},{key:'onMessage',value:function b(a){this.eventHandler&&this.eventHandler(a.data)}},{key:'postMessage',value:function b(a){this.port&&this.port.postMessage&&this.port.postMessage(a)}}]),a}();exports.default=GalleryEventReceiver;

},{"../lib/utils.js":6}],11:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_utils=require('../lib/utils.js');function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var TIMEOUT_ERROR='Request timed out!',EventAPI=function(){function a(b){_classCallCheck(this,a),this.adapter=b,this.requests={},this.isProductAPI=!0}return _createClass(a,[{key:'valid',value:function d(a,b){var c=b?'interceptableEvents':'events';return -1!==this.adapter[c].indexOf(a)}},{key:'postMessage',value:function d(a,b){var c=this;return new this.adapter.Promise(function(d,e){c.requests[b.uniqId]={resolve:d,reject:e},c.gc(b.uniqId),a.postMessage(b)})}},{key:'route',value:function f(a){var b=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.adapter.instances;if('app.derender'===a.type)return(0,_utils.removeElement)(this.adapter.instances,c[0]);var d={service:'EventAPI',data:a.data,event:a.type,uniqId:(0,_utils.generateId)()};c.filter(function(b){return -1!==b.listens.indexOf(a.type)}).forEach(function(a){return a.postMessage(d)}),d.isIntercept=!0;var e=c.filter(function(b){return -1!==b.intercepts.indexOf(a.type)}).map(function(a){return b.postMessage(a,d)});// Promise.all resolves an array, product should get nothing on resolution.
return this.adapter.Promise.all(e).then(function(){return b.adapter.Promise.resolve()})}},{key:'process',value:function e(a,b){var c=this,d=a.method;// Payload from client is a response for some 'intercept' event
return'intercept'===d?function d(){var b=c.requests[a.uniqId];return delete c.requests[a.uniqId],a.error?b.reject(a.error.message):b.resolve()}():void// Payload from client is event subscription or unsubscription request
function h(){var e=a.options.event,f=!!a.options.intercept;if(c.valid(e,f)){var g=f?'intercepts':'listens';return'off'===d?(0,_utils.removeElement)(b.app[g],e):'on'===d?(0,_utils.addElement)(b.app[g],e):void 0}}()}},{key:'gc',value:function c(a){var b=this;setTimeout(function(){b.requests[a]&&(b.requests[a].reject({message:TIMEOUT_ERROR}),delete b.requests[a])},this.adapter.interceptTimeout)}}]),a}();exports.default=EventAPI;

},{"../lib/utils.js":6}],12:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var findModalOf=function(a){return function(b){return b.parentId===a.instanceId}},findParentOf=function(a){return function(b){return a.parentId===b.instanceId}},findReceivers=function(a,b){return function(c){return -1!==b.indexOf(c.instanceId)&&c.id===a.id}},INVALID_METHOD='Method does not exist.',InstanceAPI=function(){function a(b){_classCallCheck(this,a),this.adapter=b}return _createClass(a,[{key:'close',value:function c(a,b){return this.adapter.interface({method:'closeInstance',options:{instanceId:b.app.instanceId}})}},{key:'resize',value:function c(a,b){return this.adapter.interface({method:'resize',options:_extends({},a.options,{instanceId:b.app.instanceId})})}},{key:'get',value:function e(a,b){var c=b.app,d=this.adapter.instances;return this.adapter.Promise.resolve(d.filter(function(a){return a.id===c.id}).map(function(a){return{instanceId:a.instanceId,location:a.location,parentId:a.parentId}}))}},{key:'send',value:function g(a,b){var c=b.app,d=this.adapter.instances,e={service:a.service,data:a.options.message,event:'message'},f=null;// Removing oring after adding || in client.
// Have to resolve an object so that the client resolve instead of rejecting.
return f=a.receiver&&0!==a.receiver.length?findReceivers(c,a.receiver):c.isModal?findParentOf(c):findModalOf(c),d.filter(f).forEach(function(a){return a.postMessage(e)}),this.adapter.Promise.resolve({})}},{key:'context',value:function d(a,b){var c=b.app;return this.adapter.Promise.resolve({instanceId:c.instanceId,location:c.location,parentId:c.parentId,data:c.data||{}})}},{key:'process',value:function c(a,b){return'function'==typeof this[a.method]?this[a.method](a,b):this.adapter.Promise.reject({message:INVALID_METHOD})}}]),a}();exports.default=InstanceAPI;

},{}],13:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_appInstance=require('../app/app-instance.js'),_appInstance2=_interopRequireDefault(_appInstance);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var TEMPLATE_MISSING='Missing required Parameter \'template\'',InterfaceAPI=function(){function a(b){_classCallCheck(this,a),this.adapter=b,this.isProductAPI=!0}return _createClass(a,[{key:'process',value:function f(a,b){if(-1===this.adapter.overlays.indexOf(a.method))return this.adapter.interface(a);if(!a.options.hasOwnProperty('template'))return this.adapter.Promise.reject({message:TEMPLATE_MISSING});var c=b.app,d=c.url.substring(0,c.url.lastIndexOf('/'))+'/'+a.options.template,e=new _appInstance2.default(_extends({},c.appDetails,{url:d,data:a.options.data,parentId:c.instanceId,isModal:!0}),'overlay',c.services,{product:this.adapter.product,Promise:this.adapter.Promise,locations:this.adapter.locations});return this.adapter.instances.push(e.appInstance),this.adapter.interface(_extends({},a,{instance:e}))}}]),a}();exports.default=InterfaceAPI;

},{"../app/app-instance.js":1}],14:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var INVALID_KEY_MSG='Could not find an installation parameter that matches this key.',NO_CONFIGS_MSG='No installation parameters have been defined in iparams.json.',INVALID_KEY_TYPE_MSG='The key should be a non-empty string.',SECURE_IPARAM_MSG='Secure parameters cannot be retrieved. Use the Request APIs instead.',META='__meta',SECURE='secure',IparamAPI=function(){function a(b){_classCallCheck(this,a),this.adapter=b}return _createClass(a,[{key:'process',value:function d(a,b){var c=this[a.method](a,b);return c.error?this.adapter.Promise.reject({message:c.error}):this.adapter.Promise.resolve(c)}// Remove __meta key from the configs and send all the iparams
},{key:'omitMeta',value:function c(a){var b=_extends({},a);return delete b[META],b}},{key:'getConfig',value:function d(a,b){function c(){return a.hasOwnProperty(META)&&a[META].hasOwnProperty(SECURE)&&-1!==a[META][SECURE].indexOf(b)}return function(){return'string'==typeof b&&0<b.length}()?c()?{error:SECURE_IPARAM_MSG}:(a=this.omitMeta(a),a.hasOwnProperty(b)?_defineProperty({},b,a[b]):{error:INVALID_KEY_MSG}):{error:INVALID_KEY_TYPE_MSG}}/**
    if the iparamKey is not provided, send all the iparam configs, else send the required one.
    if the app configs doesn't contain the iparamKey, send the error response.
  */},{key:'get',value:function e(a,b){var c=b.app.configs,d=a.options.attribute;return c?'undefined'==typeof d?this.omitMeta(c):this.getConfig(c,d):{error:NO_CONFIGS_MSG}}}]),a}();exports.default=IparamAPI;

},{}],15:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c],b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_utils=require('../lib/utils.js'),_utils2=_interopRequireDefault(_utils),_configs=require('../lib/configs.js'),configs=_interopRequireWildcard(_configs),_agentOauth=require('../lib/agent-oauth.js'),agentOAuth=_interopRequireWildcard(_agentOauth);function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var PROXY_ERROR_MSG='The URL should be a non-empty string.',INVALID_FEATURE='Invalid feature or feature not enabled.',TIMEOUT_ERR_MSG='Timeout error while processing the request.',SMI_ERROR_MSG='Attribute (methodName or methodParams) is of invalid type',TIMEOUT_STATUS=504,BAD_REQ_STATUS=400,REFRESH_ERROR_STATUS=210,ACCESS_TOKEN_EXPIRE_STATUS=401,RequestAPI=function(){function a(b){_classCallCheck(this,a),this.adapter=b,this.configs=configs.initialize(b)}return _createClass(a,[{key:'process',value:function d(a,b){var c=a.options.feature;return function(){return'undefined'==typeof c||-1<b.app.features.indexOf(c)}()?function(){return'oauth'===c&&b.app.isLocal}()?this.oauthHandler(a):'backend'===c?this.smiHandler(a,b):this.proxyHandler(a,b):this.adapter.Promise.reject({message:INVALID_FEATURE})}},{key:'isAgentOAuthRequest',value:function c(a,b){return agentOAuth.isAgentOAuthApp(b.app)&&a.data.isOAuth}},{key:'ajaxRequest',value:function f(a,b){var c=this,d='smi'===a.mkpRoute?this.configs.timeouts.SMI:this.configs.timeouts.PROXY,e=_extends(a.options,'smi'!==a.mkpRoute&&this.isAgentOAuthRequest(a.options,b)?agentOAuth.getOAuthTokens(b.app):{});return this.adapter.ajax({url:a.isLocal?this.configs.urls.LOCAL_DATA_PIPE:this.configs.urls.DATA_PIPE,type:'POST',timeout:d,data:_utils2.default.stringify(e),headers:{"MKP-APIKEY":this.adapter.apiKey,"MKP-AUTH-TOKEN":this.adapter.authToken,"X-CSRF-TOKEN":this.adapter.csrfToken,"content-type":'application/json',"MKP-EXTNID":a.appId,"MKP-VERSIONID":a.versionId,"MKP-ROUTE":a.mkpRoute}}).then(function(a){return a&&a.status&&a.status>=BAD_REQ_STATUS?c.adapter.Promise.reject(a):c.adapter.Promise.resolve(a)},function(a){return 0===a.status&&'timeout'===a.statusText?c.adapter.Promise.reject({status:TIMEOUT_STATUS,headers:{},response:TIMEOUT_ERR_MSG}):c.adapter.Promise.reject(a.responseJSON||{status:a.status,headers:{},response:a.responseText});// What's with this oring? When is responseJSON not present?
})}/**
    Refreshes the access token if it is expired.
  */},{key:'refreshRequest',value:function e(a,b){var c=this,d=_extends({},a,{options:_extends({},a.options)});// Weird
return d.mkpRoute='oauth',d.options.action='refresh',this.ajaxRequest(d,b).then(function(d){return d&&d.status===REFRESH_ERROR_STATUS?c.adapter.Promise.reject(d):(c.isAgentOAuthRequest(a.options,b)&&d.hasOwnProperty('tokens')&&agentOAuth.setOAuthTokens(d.tokens),c.adapter.Promise.resolve(d))})}},{key:'proxyHandler',value:function e(a,b){var c=this,d=a.options.url;return'string'==typeof d?(a={mkpRoute:'proxy',options:{action:'execute',data:_extends({},a.options,{method:a.method,isInstall:this.adapter.isInstall})},isLocal:b.app.isLocal,appId:b.app.id,versionId:b.app.versionId},this.ajaxRequest(a,b).catch(function(d){return d&&d.status===ACCESS_TOKEN_EXPIRE_STATUS&&a.options.data.isOAuth?c.refreshRequest(a,b).then(function(){return c.ajaxRequest(a,b)}):c.adapter.Promise.reject(d)})):this.adapter.Promise.reject({status:BAD_REQ_STATUS,headers:{},response:PROXY_ERROR_MSG})}// Should somehow deprecate this.
},{key:'oauthHandler',value:function a(){return location.href=this.configs.urls.LOCAL_OAUTH_REDIRECT,this.adapter.Promise.resolve({message:'success'})}},{key:'smiHandler',value:function e(a,b){var c=a.options.methodName,d=a.options.methodParams;return'string'==typeof c&&d&&d.constructor===Object?(a={mkpRoute:'smi',options:{action:'invoke',methodName:c,methodParams:d,data:{isInstall:this.adapter.isInstall}},isLocal:b.app.isLocal,appId:b.app.id,versionId:b.app.versionId},this.ajaxRequest(a,b)):this.adapter.Promise.reject({message:SMI_ERROR_MSG,status:BAD_REQ_STATUS})}}]),a}();exports.default=RequestAPI;

},{"../lib/agent-oauth.js":4,"../lib/configs.js":5,"../lib/utils.js":6}]},{},[3]);
