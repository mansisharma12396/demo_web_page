/**
 * Name: App Manager
 * Version: v1.15.0
 * Built-on: 5/11/2022
 * Author: Freshapps
 * License: ISC
 */

(function(){"use strict";function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function asyncGeneratorStep(t,e,r,n,a,o,i){try{var s=t[o](i),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,a)}function _asyncToGenerator(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var o=t.apply(e,r);function i(t){asyncGeneratorStep(o,n,a,i,s,"next",t)}function s(t){asyncGeneratorStep(o,n,a,i,s,"throw",t)}i(void 0)}))}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},runtime={exports:{}};!function(t){var e=function(t){var e,r=Object.prototype,n=r.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.asyncIterator||"@@asyncIterator",s=a.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var a=e&&e.prototype instanceof A?e:A,o=Object.create(a.prototype),i=new R(n||[]);return o._invoke=function(t,e,r){var n=l;return function(a,o){if(n===d)throw new Error("Generator is already running");if(n===f){if("throw"===a)throw o;return k()}for(r.method=a,r.arg=o;;){var i=r.delegate;if(i){var s=T(i,r);if(s){if(s===_)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===l)throw n=f,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=d;var c=p(t,e,r);if("normal"===c.type){if(n=r.done?f:h,c.arg===_)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=f,r.method="throw",r.arg=c.arg)}}}(t,r,i),o}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l="suspendedStart",h="suspendedYield",d="executing",f="completed",_={};function A(){}function m(){}function y(){}var O={};c(O,o,(function(){return this}));var v=Object.getPrototypeOf,E=v&&v(v(C([])));E&&E!==r&&n.call(E,o)&&(O=E);var g=y.prototype=A.prototype=Object.create(O);function P(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function I(t,e){function r(a,o,i,s){var c=p(t[a],t,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,i,s)}),(function(t){r("throw",t,i,s)})):e.resolve(l).then((function(t){u.value=t,i(u)}),(function(t){return r("throw",t,i,s)}))}s(c.arg)}var a;this._invoke=function(t,n){function o(){return new e((function(e,a){r(t,n,e,a)}))}return a=a?a.then(o,o):o()}}function T(t,r){var n=t.iterator[r.method];if(n===e){if(r.delegate=null,"throw"===r.method){if(t.iterator.return&&(r.method="return",r.arg=e,T(t,r),"throw"===r.method))return _;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return _}var a=p(n,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,_;var o=a.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,_):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,_)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function b(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function C(t){if(t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}return{next:k}}function k(){return{value:e,done:!0}}return m.prototype=y,c(g,"constructor",y),c(y,"constructor",m),m.displayName=c(y,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,c(t,s,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},P(I.prototype),c(I.prototype,i,(function(){return this})),t.AsyncIterator=I,t.async=function(e,r,n,a,o){void 0===o&&(o=Promise);var i=new I(u(e,r,n,a),o);return t.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},P(g),c(g,s,"Generator"),c(g,o,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=C,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(b),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(n,a){return s.type="throw",s.arg=t,r.next=n,a&&(r.method="next",r.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,_):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),_},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),b(r),_}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var a=n.arg;b(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:C(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),_}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}(runtime);var regenerator=runtime.exports;function ownKeys$8(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$8(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys$8(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys$8(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var KNOWN_ENTITIES={"MarketplaceManager.adapter":["Promise","ajax","page","product","locations","accountID","domain","galleryURL"],"EventReceiver.adapter":["iframeId","type","eventHandler"]},LOCAL_APP_ID=123456789;function generateId(){return Math.floor(Date.now()*Math.random()).toString(36)}function isValidURL(t){var e=new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,})(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i");return!t||!!e.test(t)}function validate(t,e){if(!KNOWN_ENTITIES.hasOwnProperty(t))throw new Error('Unknown entity "'.concat(t,'"'));if(!e)throw new Error('Invalid adapter object "'.concat(JSON.stringify(e),'"'));KNOWN_ENTITIES[t].forEach((function(r){if(!e.hasOwnProperty(r)&&"galleryURL"!==r)throw new Error('Expected "'.concat(t,'" to contain "').concat(r,'"'));if("galleryURL"===r&&!isValidURL(e[r]))throw new Error('Invalid Gallery URL format : "'.concat(e[r],'"'))}))}function pick(t,e){return Object.keys(t).filter((function(r){return e(r,t[r])})).reduceRight((function(e,r){return _objectSpread$8(_objectSpread$8({},e),{},_defineProperty({},r,t[r]))}),{})}function flattenArray(t){return Array.prototype.concat.apply([],t)}function removeElement(t,e){var r=t.indexOf(e);-1!==r&&t.splice(r,1)}function addElement(t,e){t.includes(e)||t.push(e)}function normalizeCLIResponse(t,e,r){if(!t.product[e])return[];var n=t.product[e].location;function a(t,e){Object.keys(t).forEach((function(n){var a=t[n];a.url="".concat(r,"://localhost:10001/iframe/").concat(e||a.url),a.icon_url="".concat(r,"://localhost:10001/iframe/").concat(a.icon)}))}var o={id:LOCAL_APP_ID,version_id:LOCAL_APP_ID,configs:t.configs,features:t.features,displayName:t.displayName,placeholders:n};return!1===t.isAuthorized?a(o.placeholders,"oauth/local-testing-oauth-msg.html"):a(o.placeholders),[o]}function checkProtocol(t){return _checkProtocol.apply(this,arguments)}function _checkProtocol(){return(_checkProtocol=_asyncToGenerator(regenerator.mark((function t(e){return regenerator.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e({type:"GET",url:"https://localhost:10001/web/assets/freshworks_logo.svg"}).then((function(){return"https"}),(function(){return"http"}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var BASE_16=16;function uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=Math.random()*BASE_16|0;return("x"===t?e:3&e|8).toString(BASE_16)}))}function getHostName(t){var e=/^(http[s]?:\/\/)?([^:^\/]+)(:\d+)?(.*)?$/.exec(t.trim());return e?e[2]:""}function getStringify(){return window.Prototype&&Object.toJSON||JSON.stringify}var JSON$1={stringify:getStringify(),parse:JSON.parse},localOauthRedirectParams=function(t){var e=document.URL;return e+="".concat(e.split("?")[1]?"&":"?","product=").concat(t)},CONFIGS={freshdesk:function(t){return{urls:{APP_LIST:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true&installation_types=live"),APP_LIST_WITH_TEST_VERSION:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true&installation_types=test,live"),COLLECTION_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/collections"),RECOMMENDATIONS_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v2/collections/recommendations"),DATA_PIPE:"https://marketplace-".concat(t.region,".freshworks.com/platform"),LOCAL_APP_LIST:"localhost:10001/iframe/api?product=".concat(t.product),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.product),LOCAL_OAUTH_REDIRECT:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product)),AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_OAUTH_URL:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product))},timeouts:{PROXY:12e3,DATA:5e3,SCHEDULE:5e3,SMI:21500}}},freshservice:function(t){return{urls:{APP_LIST:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true&installation_types=live"),APP_LIST_WITH_TEST_VERSION:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true&installation_types=test,live"),COLLECTION_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/collections"),RECOMMENDATIONS_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v2/collections/recommendations"),DATA_PIPE:"https://marketplace-".concat(t.region,".freshworks.com/platform"),LOCAL_APP_LIST:"localhost:10001/iframe/api?product=".concat(t.product),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.product),LOCAL_OAUTH_REDIRECT:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product)),AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_OAUTH_URL:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product))},timeouts:{PROXY:12e3,DATA:5e3,SCHEDULE:5e3,SMI:21500}}},freshsales:function(t){return{urls:{APP_LIST:"".concat(t.domain,"/marketplace_apps"),COLLECTION_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/collections"),RECOMMENDATIONS_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v2/collections/recommendations"),DATA_PIPE:"https://marketplace-".concat(t.region,".freshworks.com/platform"),LOCAL_APP_LIST:"localhost:10001/iframe/api?product=".concat(t.product),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.product),LOCAL_OAUTH_REDIRECT:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product)),AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_OAUTH_URL:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product))},timeouts:{PROXY:12e3,DATA:5e3,SCHEDULE:5e3,SMI:21500}}},mags:function(t){return{urls:{DATA_PIPE:"".concat(t.domain,"/data-pipe"),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.hostProduct)},timeouts:{PROXY:12e3,DATA:5e3,SCHEDULE:5e3,SMI:21500}}},freshchat:function(t){return{urls:{APP_LIST:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true"),COLLECTION_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/collections"),RECOMMENDATIONS_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v2/collections/recommendations"),DATA_PIPE:"https://marketplace-".concat(t.region,".freshworks.com/platform"),LOCAL_APP_LIST:"localhost:10001/iframe/api?product=".concat(t.product),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.product),LOCAL_OAUTH_REDIRECT:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product)),AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_OAUTH_URL:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product))},timeouts:{PROXY:12e3,DATA:5e3,SCHEDULE:5e3,SMI:21500}}},freshcaller:function(t){return{urls:{APP_LIST:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true"),COLLECTION_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/collections"),RECOMMENDATIONS_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v2/collections/recommendations"),DATA_PIPE:"https://marketplace-".concat(t.region,".freshworks.com/platform"),LOCAL_APP_LIST:"localhost:10001/iframe/api?product=".concat(t.product),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.product),LOCAL_OAUTH_REDIRECT:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product)),AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_OAUTH_URL:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product))},timeouts:{PROXY:12e3,DATA:5e3,SCHEDULE:5e3,SMI:21500}}},freshconnect:function(t){return{urls:{APP_LIST:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true"),COLLECTION_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/collections"),RECOMMENDATIONS_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v2/collections/recommendations"),DATA_PIPE:"https://marketplace-".concat(t.region,".freshworks.com/platform"),LOCAL_APP_LIST:"localhost:10001/iframe/api?product=".concat(t.product),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.product),LOCAL_OAUTH_REDIRECT:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product)),AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_OAUTH_URL:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product))},timeouts:{PROXY:12e3,DATA:5e3,SCHEDULE:5e3,SMI:21500}}},freshteam:function(t){return{urls:{APP_LIST:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&detailed=true&type=1,4,6&enabled=true"),COLLECTION_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/collections"),RECOMMENDATIONS_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v2/collections/recommendations"),DATA_PIPE:"https://marketplace-".concat(t.region,".freshworks.com/platform"),LOCAL_APP_LIST:"localhost:10001/iframe/api?product=".concat(t.product),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.product),LOCAL_OAUTH_REDIRECT:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product)),AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_OAUTH_URL:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product))},timeouts:{PROXY:12e3,DATA:5e3,SCHEDULE:5e3,SMI:21500}}},freshworks_crm:function(t){return{urls:{APP_LIST:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/installations?product=").concat(t.product,"&account=").concat(t.accountID,"&bundle=").concat(t.bundleID,"&detailed=true&type=1,4,6&enabled=true"),COLLECTION_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v1/collections"),RECOMMENDATIONS_APPS:"https://marketplace-".concat(t.region,".freshworks.com/api/v2/collections/recommendations"),DATA_PIPE:"https://marketplace-".concat(t.region,".freshworks.com/platform"),LOCAL_APP_LIST:"localhost:10001/iframe/api?product=".concat(t.product),LOCAL_DATA_PIPE:"localhost:10001/dprouter?product=".concat(t.product),LOCAL_OAUTH_REDIRECT:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product)),AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_AGENT_OAUTH_HTML:"https://dl.freshdev.io/oauth/agent_oauth.html",LOCAL_OAUTH_URL:"localhost:10001/auth/index?callback=".concat(localOauthRedirectParams(t.product))},timeouts:{PROXY:12e3,DATA:5e3,SCHEDULE:5e3,SMI:21500}}}};function initialize(t){var e=t.product;if(!CONFIGS.hasOwnProperty(e))throw new Error('Unsupported product "'.concat(e,'"'));return CONFIGS[e](t)}var ACTIVATE_TIMEOUT=1e3;function isAgentOAuthApp(t){return t.features.includes("agent_oauth")}function getKey(t){return"app_".concat(t.id,"_").concat(t.versionId)}function getOAuthTokens(t){return JSON$1.parse(window.localStorage.getItem(getKey(t)))||{}}function hasOAuthTokens(t){return Object.keys(getOAuthTokens(t)).length>0}function setOAuthTokens(t,e){return window.localStorage.setItem(getKey(t),JSON$1.stringify(e))}function clearOAuthTokens(t){window.localStorage.removeItem(getKey(t))}function getAuthorizeUrl(t,e){return t.isLocal?"".concat(t.protocol,"://").concat(e.urls.LOCAL_OAUTH_URL):t.authorizeUrl}function getOAuthSrc(t,e){return t.isLocal?e.urls.LOCAL_AGENT_OAUTH_HTML:e.urls.AGENT_OAUTH_HTML}function onMessage(t,e,r){var n=e.instances.filter((function(e){return e.versionId===Number(t.data.versionId)}));if("agent_oauth_handshake"===t.data.type&&n.length>0)return t.data.hasOwnProperty("error")?e.interface({method:"showNotify",options:{message:t.data.error.message,type:"danger"}}):"authorize"===t.data.method?window.open(getAuthorizeUrl(n[0],r),"","height=600,width=800"):void(t.data.hasOwnProperty("tokens")&&(setOAuthTokens(n[0],{tokens:t.data.tokens}),n.forEach((function(t){t.element.src=t.getSourceURL(),setTimeout((function(){t.triggerAppEvent({type:"app.activated"})}),ACTIVATE_TIMEOUT)}))))}function ownKeys$7(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$7(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys$7(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys$7(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var CUSTOM_IPARAM_API="CustomIparamAPI",CUSTOM_IPARAM$2="custom_iparam",SET_CONFIGS="getConfigs",APPLY_EVENT$1="custom_iparam.apply",CANCEL_EVENT$1="custom_iparam.cancel",SUBMIT_EVENT="custom_iparam.submit",LISTEN_EVENT="custom_iparam.listen",AppInstance=function(){function t(e,r,n,a){var o=this;return _classCallCheck(this,t),Object.assign(this,e),this.location=r,this.appDetails=e,this.instanceId=generateId(),this.locationDetails=a.locations[this.location],this.appMgrConfigs=initialize(a),this.listens=["app.activated","app.deactivated"],this.intercepts=[],this.adapter=this.getAdapter(a),this.services=_objectSpread$7({},n),this.handshakePromise=new a.Promise((function(t,e){o.handshake={resolve:t,reject:e}})),this.constructIframe()}return _createClass(t,[{key:"postMessage",value:function(t){this.channel.port1.postMessage(JSON$1.stringify(t))}},{key:"getContext",value:function(){return{product:this.adapter.hostProduct||this.adapter.product,productContext:this.adapter.productContext,page:this.adapter.page,location:this.location,settings:this.configs,account:{full_domain:this.adapter.domain}}}},{key:"getAdapter",value:function(t){return t.productContext?t:_objectSpread$7(_objectSpread$7({},t),{},{productContext:{url:t.domain,name:t.hostProduct||t.product}})}},{key:"getAppContext",value:function(){return{app:this}}},{key:"isCustomIparam",value:function(){return this.location===CUSTOM_IPARAM$2}},{key:"onMessage",value:function(t){var e=this;if("iframe:loaded"===t.data.type)return this.handshake.resolve(),this.isCustomIparam()?this.services[CUSTOM_IPARAM_API].process({method:SET_CONFIGS,options:{configs:this.configs,productConfigs:this.productConfigs,isInstall:this.isInstall}},this.getAppContext()):void 0;if("EventAPI"===t.data.service)return this.services[t.data.service].process(t.data,this.getAppContext());if(t.data.service===CUSTOM_IPARAM_API)return this.services[t.data.service].responseHandler(t.data);var r={service:t.data.service,uniqId:t.data.uniqId};this.services[t.data.service].process(t.data,this.getAppContext()).then((function(t){r.respData=t,e.postMessage(r)})).catch((function(t){r.error=t,e.postMessage(r)}))}},{key:"initializeChannel",value:function(){var t=this;this.channel=new MessageChannel,this.channel.port1.onmessage=function(e){return t.onMessage(e)}}},{key:"getSourceURL",value:function(){if(this.isCustomIparam()||!isAgentOAuthApp(this.appDetails)||hasOAuthTokens(this.appDetails))return this.url;var t,e={versionId:this.appDetails.versionId,product:this.adapter.product};return this.locationDetails.hasViewport||(e.showPopup=!0),"".concat(getOAuthSrc(this.appDetails,this.appMgrConfigs),"?").concat((t=e,Object.keys(t).map((function(e){return[].concat("".concat(e,"=").concat(encodeURIComponent(t[e]))).join("&")})).join("&")))}},{key:"constructIframe",value:function(){var t=this,e=document.createElement("iframe");return e.sandbox="allow-scripts allow-forms allow-same-origin allow-popups allow-modals allow-downloads",e.allow="geolocation; microphone; autoplay",e.id=this.instanceId,e.src=this.getSourceURL(),e.addEventListener("load",(function(){t.initializeChannel(),e.contentWindow.postMessage({type:"iframe:handshake",instanceId:t.instanceId,services:Object.keys(t.services),context:t.getContext()},"*",[t.channel.port2])})),this.element=e,{id:this.id,element:this.element,appInstance:this,iconURL:this.iconURL,location:this.location,displayName:this.displayName,trigger:function(e){return e.type===SUBMIT_EVENT?t.submitCustomIparam():e.type===LISTEN_EVENT?t.listenEvent(e.callback):t.triggerAppEvent(e)}}}},{key:"triggerAppEvent",value:function(t){var e=this;return this.handshakePromise.then((function(){return e.services.EventAPI.route(t,[e])}))}},{key:"submitCustomIparam",value:function(){var t=this,e=this.services[CUSTOM_IPARAM_API];return e.process({method:"validate"},this.getAppContext()).then((function(){return e.process({method:"postConfigs"},t.getAppContext())}))}},{key:"listenEvent",value:function(t){window.addEventListener(APPLY_EVENT$1,(function(){t("install")})),window.addEventListener(CANCEL_EVENT$1,(function(){t("cancel")}))}}]),t}(),SANDBOX_VALUES=["allow-scripts","allow-downloads","allow-top-navigation","allow-popups","allow-modals","allow-same-origin","allow-forms"],galleryInstance=function(){function t(e){_classCallCheck(this,t),this.channel=e.channel,this.adapter=e.adapter}return _createClass(t,[{key:"getGallery",value:function(t){var e=this,r=this.constructGalleryURL(t);return{iframeElement:this.constructIframeElement(r),redirectUrl:r,redirect:function(t,r){return e.redirectToRoute(t,r)}}}},{key:"constructIframeElement",value:function(t){var e=document.createElement("iframe");e.setAttribute("src",t),e.setAttribute("class","marketplace-gallery-iframe");var r=SANDBOX_VALUES.join(" ");return e.setAttribute("sandbox",r),this.adapter.iframeID&&e.setAttribute("id",this.adapter.iframeID),e}},{key:"redirectToRoute",value:function(t,e){this.channel.postMessage({route:t,option:e})}},{key:"constructGalleryURL",value:function(t){var e=this.constructBaseURL(),r="".concat(e,"/client/#/create-session?"),n=this.getQueryParams(t);return r="".concat(r).concat(n),!1===this.adapter.isFreshID&&(r=t.iframeURL),r}},{key:"constructBaseURL",value:function(){var t=this.adapter,e=t.tenant,r=t.account,n=t.region,a="staging"===n?"freshcloud.io":"freshworks.com",o="us"!==n?"-".concat(n):"";return"dev"===n?"https://app-gallery-fa-dev-staging.freshcloud.io":"https://".concat(e,"-").concat(r,".appgallery").concat(o,".").concat(a)}},{key:"getQueryParams",value:function(t){var e=this.adapter,r=e.locale,n=e.pod,a=e.isFreshID,o=t.encryptedParam,i=t.initialRoute,s=t.option,c=[{key:"param",value:o},{key:"pod",value:n},{key:"route",value:i}];r&&c.push({key:"locale",value:r}),!1===a&&c.push({key:"freshID",value:a});var u=c.reduce((function(t,e,r){return 0===r?"".concat(e.key,"=").concat(e.value):"".concat(t,"&").concat(e.key,"=").concat(e.value)}),c[0]);if(s){var p=encodeURI(JSON.stringify(s)||"");u="".concat(u,"&option=").concat(p)}return u}}]),t}(),ApiToken=function(){function t(e){var r=this;if(_classCallCheck(this,t),t.instance)return t.instance;t.instance=this,this.timeOut=null,this.adapter=e,"function"==typeof this.adapter.getApiToken&&this.adapter.authentication&&(this.apiToken=this.adapter.authentication.api_token,this.refreshInterval=this.convertEpochToUTC(this.adapter.authentication.refresh_at),setTimeout((function(){return r.refreshApiToken(r.adapter)}),this.getRefreshInterval()))}var e;return _createClass(t,[{key:"refreshApiToken",value:(e=_asyncToGenerator(regenerator.mark((function t(e){var r,n=this;return regenerator.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.getApiToken();case 3:r=t.sent,this.apiToken=r.api_token,this.refreshInterval=this.convertEpochToUTC(r.refresh_at),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("getApiToken failed",t.t0);case 11:return t.prev=11,clearTimeout(this.timeOut),this.timeOut=setTimeout((function(){return n.refreshApiToken(e)}),this.getRefreshInterval()),t.finish(11);case 15:case"end":return t.stop()}}),t,this,[[0,8,11,15]])}))),function(t){return e.apply(this,arguments)})},{key:"getRefreshInterval",value:function(){var t=this.refreshInterval-(new Date).getTime(),e=69e5;return t<e?e:t}},{key:"convertEpochToUTC",value:function(t){return new Date(1e3*t).getTime()}},{key:"getApiToken",value:function(){return this.apiToken}}]),t}(),DataAPI=function(){function t(e){_classCallCheck(this,t),this.adapter=e,this.isProductAPI=!0}return _createClass(t,[{key:"process",value:function(t){return this.adapter.getAttribute(t.options.attribute)}}]),t}(),TIMEOUT_ERROR$1="Request timed out!",EventAPI=function(){function t(e){_classCallCheck(this,t),this.adapter=e,this.requests={},this.isProductAPI=!0}return _createClass(t,[{key:"valid",value:function(t,e){var r=e?"interceptableEvents":"events";return this.adapter[r].includes(t)}},{key:"postMessage",value:function(t,e){var r=this;return new this.adapter.Promise((function(n,a){r.requests[e.uniqId]={resolve:n,reject:a},r.gc(e.uniqId),t.postMessage(e)}))}},{key:"route",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.adapter.instances;if("app.derender"===t.type)return removeElement(this.adapter.instances,r[0]);var n={service:"EventAPI",data:t.data,event:t.type,uniqId:generateId()};r.filter((function(e){return e.listens.includes(t.type)})).forEach((function(t){return t.postMessage(n)})),n.isIntercept=!0;var a=r.filter((function(e){return e.intercepts.includes(t.type)})).map((function(t){return e.postMessage(t,n)}));return this.adapter.Promise.all(a).then((function(){return e.adapter.Promise.resolve()}))}},{key:"process",value:function(t,e){var r,n=this,a=t.method;if("intercept"===a)return r=n.requests[t.uniqId],delete n.requests[t.uniqId],t.error?r.reject(t.error.message):r.resolve();!function(){var r=t.options.event,o=!!t.options.intercept;if(n.valid(r,o)){var i=o?"intercepts":"listens";"off"===a?removeElement(e.app[i],r):"on"===a&&addElement(e.app[i],r)}}()}},{key:"gc",value:function(t){var e=this;setTimeout((function(){e.requests[t]&&(e.requests[t].reject({message:TIMEOUT_ERROR$1}),delete e.requests[t])}),this.adapter.interceptTimeout)}}]),t}();function ownKeys$6(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$6(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys$6(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys$6(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var INVALID_KEY_MSG="Could not find an installation parameter that matches this key.",NO_CONFIGS_MSG="No installation parameters have been defined in iparams.json.",INVALID_KEY_TYPE_MSG="The key should be a non-empty string.",SECURE_IPARAM_MSG="Secure parameters cannot be retrieved. Use the Request APIs instead.",META="__meta",SECURE="secure",CUSTOM_IPARAM$1="custom_iparam",INVALID_METHOD$2="Method does not exist.",APPLY_EVENT="custom_iparam.apply",CANCEL_EVENT="custom_iparam.cancel",IparamAPI=function(){function t(e){_classCallCheck(this,t),this.adapter=e}return _createClass(t,[{key:"process",value:function(t,e){var r=this[t.method](t,e);return r.error?this.adapter.Promise.reject({message:r.error}):this.adapter.Promise.resolve(r)}},{key:"omitMeta",value:function(t){var e=_objectSpread$6({},t);return delete e[META],e}},{key:"getConfig",value:function(t,e){return"string"==typeof e&&e.length>0?t.hasOwnProperty(META)&&t[META].hasOwnProperty(SECURE)&&t[META][SECURE].includes(e)?{error:SECURE_IPARAM_MSG}:(t=this.omitMeta(t)).hasOwnProperty(e)?_defineProperty({},e,t[e]):{error:INVALID_KEY_MSG}:{error:INVALID_KEY_TYPE_MSG}}},{key:"get",value:function(t,e){var r=e.app.configs,n=t.options.attribute;return r?void 0===n?this.omitMeta(r):this.getConfig(r,n):{error:NO_CONFIGS_MSG}}},{key:"getState",value:function(t,e){return e.app.location===CUSTOM_IPARAM$1?e.app.state:{error:INVALID_METHOD$2}}},{key:"apply",value:function(t,e){return e.app.location===CUSTOM_IPARAM$1?window.dispatchEvent(new Event(APPLY_EVENT)):{error:INVALID_METHOD$2}}},{key:"cancel",value:function(t,e){return e.app.location===CUSTOM_IPARAM$1?window.dispatchEvent(new Event(CANCEL_EVENT)):{error:INVALID_METHOD$2}}}]),t}(),md5$1={exports:{}};
/**
   * [js-md5]{@link https://github.com/emn178/js-md5}
   *
   * @namespace md5
   * @version 0.7.3
   * @author Chen, Yi-Cyuan [emn178@gmail.com]
   * @copyright Chen, Yi-Cyuan 2014-2017
   * @license MIT
   */
(function(module){(function(){var ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_MD5_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_MD5_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=commonjsGlobal:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_MD5_NO_COMMON_JS&&module.exports,ARRAY_BUFFER=!root.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[128,32768,8388608,-2147483648],SHIFT=[0,8,16,24],OUTPUT_TYPES=["hex","array","digest","buffer","arrayBuffer","base64"],BASE64_ENCODE_CHAR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),blocks=[],buffer8;if(ARRAY_BUFFER){var buffer=new ArrayBuffer(68);buffer8=new Uint8Array(buffer),blocks=new Uint32Array(buffer)}!root.JS_MD5_NO_NODE_JS&&Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),!ARRAY_BUFFER||!root.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(t){return"object"==typeof t&&t.buffer&&t.buffer.constructor===ArrayBuffer});var createOutputMethod=function(t){return function(e){return new Md5(!0).update(e)[t]()}},createMethod=function(){var t=createOutputMethod("hex");NODE_JS&&(t=nodeWrap(t)),t.create=function(){return new Md5},t.update=function(e){return t.create().update(e)};for(var e=0;e<OUTPUT_TYPES.length;++e){var r=OUTPUT_TYPES[e];t[r]=createOutputMethod(r)}return t},nodeWrap=function(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(t){if("string"==typeof t)return crypto.createHash("md5").update(t,"utf8").digest("hex");if(null==t)throw ERROR;return t.constructor===ArrayBuffer&&(t=new Uint8Array(t)),Array.isArray(t)||ArrayBuffer.isView(t)||t.constructor===Buffer?crypto.createHash("md5").update(new Buffer(t)).digest("hex"):method(t)};return nodeMethod};function Md5(t){if(t)blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks,this.buffer8=buffer8;else if(ARRAY_BUFFER){var e=new ArrayBuffer(68);this.buffer8=new Uint8Array(e),this.blocks=new Uint32Array(e)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Md5.prototype.update=function(t){if(!this.finalized){var e,r=typeof t;if("string"!==r){if("object"!==r)throw ERROR;if(null===t)throw ERROR;if(ARRAY_BUFFER&&t.constructor===ArrayBuffer)t=new Uint8Array(t);else if(!(Array.isArray(t)||ARRAY_BUFFER&&ArrayBuffer.isView(t)))throw ERROR;e=!0}for(var n,a,o=0,i=t.length,s=this.blocks,c=this.buffer8;o<i;){if(this.hashed&&(this.hashed=!1,s[0]=s[16],s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),e)if(ARRAY_BUFFER)for(a=this.start;o<i&&a<64;++o)c[a++]=t[o];else for(a=this.start;o<i&&a<64;++o)s[a>>2]|=t[o]<<SHIFT[3&a++];else if(ARRAY_BUFFER)for(a=this.start;o<i&&a<64;++o)(n=t.charCodeAt(o))<128?c[a++]=n:n<2048?(c[a++]=192|n>>6,c[a++]=128|63&n):n<55296||n>=57344?(c[a++]=224|n>>12,c[a++]=128|n>>6&63,c[a++]=128|63&n):(n=65536+((1023&n)<<10|1023&t.charCodeAt(++o)),c[a++]=240|n>>18,c[a++]=128|n>>12&63,c[a++]=128|n>>6&63,c[a++]=128|63&n);else for(a=this.start;o<i&&a<64;++o)(n=t.charCodeAt(o))<128?s[a>>2]|=n<<SHIFT[3&a++]:n<2048?(s[a>>2]|=(192|n>>6)<<SHIFT[3&a++],s[a>>2]|=(128|63&n)<<SHIFT[3&a++]):n<55296||n>=57344?(s[a>>2]|=(224|n>>12)<<SHIFT[3&a++],s[a>>2]|=(128|n>>6&63)<<SHIFT[3&a++],s[a>>2]|=(128|63&n)<<SHIFT[3&a++]):(n=65536+((1023&n)<<10|1023&t.charCodeAt(++o)),s[a>>2]|=(240|n>>18)<<SHIFT[3&a++],s[a>>2]|=(128|n>>12&63)<<SHIFT[3&a++],s[a>>2]|=(128|n>>6&63)<<SHIFT[3&a++],s[a>>2]|=(128|63&n)<<SHIFT[3&a++]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Md5.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[e>>2]|=EXTRA[3&e],e>=56&&(this.hashed||this.hash(),t[0]=t[16],t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.bytes<<3,t[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},Md5.prototype.hash=function(){var t,e,r,n,a,o,i=this.blocks;this.first?e=((e=((t=((t=i[0]-680876937)<<7|t>>>25)-271733879<<0)^(r=((r=(-271733879^(n=((n=(-1732584194^2004318071&t)+i[1]-117830708)<<12|n>>>20)+t<<0)&(-271733879^t))+i[2]-1126478375)<<17|r>>>15)+n<<0)&(n^t))+i[3]-1316259209)<<22|e>>>10)+r<<0:(t=this.h0,e=this.h1,r=this.h2,e=((e+=((t=((t+=((n=this.h3)^e&(r^n))+i[0]-680876936)<<7|t>>>25)+e<<0)^(r=((r+=(e^(n=((n+=(r^t&(e^r))+i[1]-389564586)<<12|n>>>20)+t<<0)&(t^e))+i[2]+606105819)<<17|r>>>15)+n<<0)&(n^t))+i[3]-1044525330)<<22|e>>>10)+r<<0),e=((e+=((t=((t+=(n^e&(r^n))+i[4]-176418897)<<7|t>>>25)+e<<0)^(r=((r+=(e^(n=((n+=(r^t&(e^r))+i[5]+1200080426)<<12|n>>>20)+t<<0)&(t^e))+i[6]-1473231341)<<17|r>>>15)+n<<0)&(n^t))+i[7]-45705983)<<22|e>>>10)+r<<0,e=((e+=((t=((t+=(n^e&(r^n))+i[8]+1770035416)<<7|t>>>25)+e<<0)^(r=((r+=(e^(n=((n+=(r^t&(e^r))+i[9]-1958414417)<<12|n>>>20)+t<<0)&(t^e))+i[10]-42063)<<17|r>>>15)+n<<0)&(n^t))+i[11]-1990404162)<<22|e>>>10)+r<<0,e=((e+=((t=((t+=(n^e&(r^n))+i[12]+1804603682)<<7|t>>>25)+e<<0)^(r=((r+=(e^(n=((n+=(r^t&(e^r))+i[13]-40341101)<<12|n>>>20)+t<<0)&(t^e))+i[14]-1502002290)<<17|r>>>15)+n<<0)&(n^t))+i[15]+1236535329)<<22|e>>>10)+r<<0,e=((e+=((n=((n+=(e^r&((t=((t+=(r^n&(e^r))+i[1]-165796510)<<5|t>>>27)+e<<0)^e))+i[6]-1069501632)<<9|n>>>23)+t<<0)^t&((r=((r+=(t^e&(n^t))+i[11]+643717713)<<14|r>>>18)+n<<0)^n))+i[0]-373897302)<<20|e>>>12)+r<<0,e=((e+=((n=((n+=(e^r&((t=((t+=(r^n&(e^r))+i[5]-701558691)<<5|t>>>27)+e<<0)^e))+i[10]+38016083)<<9|n>>>23)+t<<0)^t&((r=((r+=(t^e&(n^t))+i[15]-660478335)<<14|r>>>18)+n<<0)^n))+i[4]-405537848)<<20|e>>>12)+r<<0,e=((e+=((n=((n+=(e^r&((t=((t+=(r^n&(e^r))+i[9]+568446438)<<5|t>>>27)+e<<0)^e))+i[14]-1019803690)<<9|n>>>23)+t<<0)^t&((r=((r+=(t^e&(n^t))+i[3]-187363961)<<14|r>>>18)+n<<0)^n))+i[8]+1163531501)<<20|e>>>12)+r<<0,e=((e+=((n=((n+=(e^r&((t=((t+=(r^n&(e^r))+i[13]-1444681467)<<5|t>>>27)+e<<0)^e))+i[2]-51403784)<<9|n>>>23)+t<<0)^t&((r=((r+=(t^e&(n^t))+i[7]+1735328473)<<14|r>>>18)+n<<0)^n))+i[12]-1926607734)<<20|e>>>12)+r<<0,e=((e+=((o=(n=((n+=((a=e^r)^(t=((t+=(a^n)+i[5]-378558)<<4|t>>>28)+e<<0))+i[8]-2022574463)<<11|n>>>21)+t<<0)^t)^(r=((r+=(o^e)+i[11]+1839030562)<<16|r>>>16)+n<<0))+i[14]-35309556)<<23|e>>>9)+r<<0,e=((e+=((o=(n=((n+=((a=e^r)^(t=((t+=(a^n)+i[1]-1530992060)<<4|t>>>28)+e<<0))+i[4]+1272893353)<<11|n>>>21)+t<<0)^t)^(r=((r+=(o^e)+i[7]-155497632)<<16|r>>>16)+n<<0))+i[10]-1094730640)<<23|e>>>9)+r<<0,e=((e+=((o=(n=((n+=((a=e^r)^(t=((t+=(a^n)+i[13]+681279174)<<4|t>>>28)+e<<0))+i[0]-358537222)<<11|n>>>21)+t<<0)^t)^(r=((r+=(o^e)+i[3]-722521979)<<16|r>>>16)+n<<0))+i[6]+76029189)<<23|e>>>9)+r<<0,e=((e+=((o=(n=((n+=((a=e^r)^(t=((t+=(a^n)+i[9]-640364487)<<4|t>>>28)+e<<0))+i[12]-421815835)<<11|n>>>21)+t<<0)^t)^(r=((r+=(o^e)+i[15]+530742520)<<16|r>>>16)+n<<0))+i[2]-995338651)<<23|e>>>9)+r<<0,e=((e+=((n=((n+=(e^((t=((t+=(r^(e|~n))+i[0]-198630844)<<6|t>>>26)+e<<0)|~r))+i[7]+1126891415)<<10|n>>>22)+t<<0)^((r=((r+=(t^(n|~e))+i[14]-1416354905)<<15|r>>>17)+n<<0)|~t))+i[5]-57434055)<<21|e>>>11)+r<<0,e=((e+=((n=((n+=(e^((t=((t+=(r^(e|~n))+i[12]+1700485571)<<6|t>>>26)+e<<0)|~r))+i[3]-1894986606)<<10|n>>>22)+t<<0)^((r=((r+=(t^(n|~e))+i[10]-1051523)<<15|r>>>17)+n<<0)|~t))+i[1]-2054922799)<<21|e>>>11)+r<<0,e=((e+=((n=((n+=(e^((t=((t+=(r^(e|~n))+i[8]+1873313359)<<6|t>>>26)+e<<0)|~r))+i[15]-30611744)<<10|n>>>22)+t<<0)^((r=((r+=(t^(n|~e))+i[6]-1560198380)<<15|r>>>17)+n<<0)|~t))+i[13]+1309151649)<<21|e>>>11)+r<<0,e=((e+=((n=((n+=(e^((t=((t+=(r^(e|~n))+i[4]-145523070)<<6|t>>>26)+e<<0)|~r))+i[11]-1120210379)<<10|n>>>22)+t<<0)^((r=((r+=(t^(n|~e))+i[2]+718787259)<<15|r>>>17)+n<<0)|~t))+i[9]-343485551)<<21|e>>>11)+r<<0,this.first?(this.h0=t+1732584193<<0,this.h1=e-271733879<<0,this.h2=r-1732584194<<0,this.h3=n+271733878<<0,this.first=!1):(this.h0=this.h0+t<<0,this.h1=this.h1+e<<0,this.h2=this.h2+r<<0,this.h3=this.h3+n<<0)},Md5.prototype.hex=function(){this.finalize();var t=this.h0,e=this.h1,r=this.h2,n=this.h3;return HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[n>>4&15]+HEX_CHARS[15&n]+HEX_CHARS[n>>12&15]+HEX_CHARS[n>>8&15]+HEX_CHARS[n>>20&15]+HEX_CHARS[n>>16&15]+HEX_CHARS[n>>28&15]+HEX_CHARS[n>>24&15]},Md5.prototype.toString=Md5.prototype.hex,Md5.prototype.digest=function(){this.finalize();var t=this.h0,e=this.h1,r=this.h2,n=this.h3;return[255&t,t>>8&255,t>>16&255,t>>24&255,255&e,e>>8&255,e>>16&255,e>>24&255,255&r,r>>8&255,r>>16&255,r>>24&255,255&n,n>>8&255,n>>16&255,n>>24&255]},Md5.prototype.array=Md5.prototype.digest,Md5.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(16),e=new Uint32Array(t);return e[0]=this.h0,e[1]=this.h1,e[2]=this.h2,e[3]=this.h3,t},Md5.prototype.buffer=Md5.prototype.arrayBuffer,Md5.prototype.base64=function(){for(var t,e,r,n="",a=this.array(),o=0;o<15;)t=a[o++],e=a[o++],r=a[o++],n+=BASE64_ENCODE_CHAR[t>>>2]+BASE64_ENCODE_CHAR[63&(t<<4|e>>>4)]+BASE64_ENCODE_CHAR[63&(e<<2|r>>>6)]+BASE64_ENCODE_CHAR[63&r];return t=a[o],n+=BASE64_ENCODE_CHAR[t>>>2]+BASE64_ENCODE_CHAR[t<<4&63]+"=="};var exports=createMethod();COMMON_JS?module.exports=exports:root.md5=exports})()})(md5$1);var md5=md5$1.exports,DEFAULT_TTL=6e5,DEFAULT_CACHE_KEY="mkp_cache_",MAX_RETRY=5,ClientCache=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:DEFAULT_TTL,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:DEFAULT_CACHE_KEY;_classCallCheck(this,t),this.default_ttl=e,this.cacheKeyPrefix=r}return _createClass(t,[{key:"getItem",value:function(t){var e=JSON.parse(window.sessionStorage.getItem(this.getHashedKey(t))||null);return e&&e.expires>Date.now()?e.data:null}},{key:"setItem",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.default_ttl,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:MAX_RETRY;try{window.sessionStorage.setItem(this.getHashedKey(t),JSON.stringify({expires:Date.now()+r,data:e}))}catch(o){var a=["QuotaExceededError","NS_ERROR_DOM_QUOTA_REACHED"];a.includes(o.name)&&n>=0&&(this.removeOldestItem(),this.setItem(t,e,r,n-1))}}},{key:"removeOldestItem",value:function(){var t=this.getAllItems(),e=Object.keys(t).sort((function(e,r){return JSON.parse(t[r]).expires-JSON.parse(t[e]).expires}));window.sessionStorage.removeItem(e[0])}},{key:"getHashedKey",value:function(t){return"".concat(this.cacheKeyPrefix).concat(t.versionId,"_").concat(md5(JSON.stringify(t)))}},{key:"getAllItems",value:function(){var t=this,e=JSON.parse(JSON.stringify(window.sessionStorage));return Object.keys(e).filter((function(e){return 0===e.indexOf(t.cacheKeyPrefix)})).reduce((function(t,r){return t[r]=e[r],t}),{})}}]),t}();function ownKeys$5(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$5(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys$5(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys$5(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var PROXY_ERROR_MSG="The URL should be a non-empty string.",INVALID_FEATURE="Invalid feature or feature not enabled.",TIMEOUT_ERR_MSG="Timeout error while processing the request.",SMI_ERROR_MSG="Attribute (methodName or methodParams) is of invalid type",TIMEOUT_STATUS=504,BAD_REQ_STATUS$1=400,REFRESH_ERROR_STATUS=210,ACCESS_TOKEN_EXPIRE_STATUS=401,RequestAPI=function(){function t(e){_classCallCheck(this,t),this.adapter=e,this.configs=initialize(e),this.cacheManager=new ClientCache}return _createClass(t,[{key:"process",value:function(t,e){var r=t.options.feature;return void 0===r||e.app.features.indexOf(r)>-1?"oauth"===r&&e.app.isLocal?this.oauthHandler(e.app.protocol):"backend"===r?this.smiHandler(t,e):this.proxyHandler(t,e):this.adapter.Promise.reject({message:INVALID_FEATURE})}},{key:"isAgentOAuthRequest",value:function(t,e){return isAgentOAuthApp(e.app)&&t.data.isOAuth}},{key:"getRequestPayload",value:function(t,e){return Object.assign(t.options,"smi"!==t.mkpRoute&&this.isAgentOAuthRequest(t.options,e)?getOAuthTokens(e.app):{})}},{key:"isCacheEnabled",value:function(t){return"get"===t.options.data.method&&!!t.options.data.cache}},{key:"ajaxRequest",value:function(t,e){var r=this,n=null,a=this.isCacheEnabled(t);if(a){n={appId:t.appId,versionId:t.versionId,url:t.options.data.url,headers:t.options.data.headers};var o=this.cacheManager.getItem(n);if(o)return this.adapter.Promise.resolve(o)}var i="smi"===t.mkpRoute?this.configs.timeouts.SMI:this.configs.timeouts.PROXY,s=this.getRequestPayload(t,e);return s=_objectSpread$5(_objectSpread$5({},s),{},{isInstall:this.adapter.isInstall}),this.adapter.ajax({url:t.isLocal?"".concat(e.app.protocol,"://").concat(this.configs.urls.LOCAL_DATA_PIPE):this.configs.urls.DATA_PIPE,type:"POST",timeout:i,data:JSON$1.stringify(s),headers:{"X-REQUEST-ID":uuidv4(),"MKP-APIKEY":this.adapter.apiKey,"MKP-AUTH-TOKEN":this.adapter.authToken,"X-CSRF-TOKEN":this.adapter.csrfToken,"content-type":"application/json","MKP-EXTNID":t.appId,"MKP-VERSIONID":t.versionId,"MKP-ROUTE":t.mkpRoute}}).then((function(e){return e&&e.status&&e.status>=BAD_REQ_STATUS$1?r.adapter.Promise.reject(e):(a&&r.cacheManager.setItem(n,e,t.options.data.ttl),r.adapter.Promise.resolve(e))}),(function(t){return 0===t.status&&"timeout"===t.statusText?r.adapter.Promise.reject({status:TIMEOUT_STATUS,headers:{},response:TIMEOUT_ERR_MSG}):r.adapter.Promise.reject(t.responseJSON||{status:t.status,headers:{},response:t.responseText})}))}},{key:"refreshRequest",value:function(t,e){var r=this,n=_objectSpread$5(_objectSpread$5({},t),{},{options:_objectSpread$5({},t.options)});return n.mkpRoute="oauth",n.options.action="refresh",this.ajaxRequest(n,e).then((function(n){return n&&n.status===REFRESH_ERROR_STATUS?r.adapter.Promise.reject(n):(r.isAgentOAuthRequest(t.options,e)&&n.hasOwnProperty("tokens")&&setOAuthTokens(e.app,{tokens:n.tokens}),r.adapter.Promise.resolve(n))}))}},{key:"proxyHandler",value:function(t,e){var r=this;return"string"!=typeof t.options.url?this.adapter.Promise.reject({status:BAD_REQ_STATUS$1,headers:{},response:PROXY_ERROR_MSG}):(t={mkpRoute:"proxy",options:{action:"execute",data:_objectSpread$5(_objectSpread$5({},t.options),{},{method:t.method,isInstall:this.adapter.isInstall})},isLocal:e.app.isLocal,appId:e.app.id,versionId:e.app.versionId},this.ajaxRequest(t,e).catch((function(n){return n&&n.status===ACCESS_TOKEN_EXPIRE_STATUS&&t.options.data.isOAuth?r.refreshRequest(t,e).then((function(){return r.ajaxRequest(t,e)})):r.adapter.Promise.reject(n)})))}},{key:"oauthHandler",value:function(t){return location.href="".concat(t,"://").concat(this.configs.urls.LOCAL_OAUTH_REDIRECT),this.adapter.Promise.resolve({message:"success"})}},{key:"smiHandler",value:function(t,e){var r=t.options.methodName,n=t.options.methodParams;return"string"==typeof r&&n&&n.constructor===Object?(t={mkpRoute:"smi",options:{action:"invoke",methodName:r,methodParams:n,data:{isInstall:this.adapter.isInstall}},isLocal:e.app.isLocal,appId:e.app.id,versionId:e.app.versionId},this.ajaxRequest(t,e)):this.adapter.Promise.reject({message:SMI_ERROR_MSG,status:BAD_REQ_STATUS$1})}}]),t}();function ownKeys$4(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$4(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys$4(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys$4(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var findModalOf=function(t){return function(e){return e.parentId===t.instanceId}},findParentOf=function(t){return function(e){return t.parentId===e.instanceId}},findReceivers=function(t,e){return function(r){return e.includes(r.instanceId)&&r.id===t.id}},INVALID_METHOD$1="Method does not exist.",InstanceAPI=function(){function t(e){_classCallCheck(this,t),this.adapter=e}return _createClass(t,[{key:"close",value:function(t,e){return this.adapter.interface({method:"closeInstance",options:{instanceId:e.app.instanceId}})}},{key:"resize",value:function(t,e){return this.adapter.interface({method:"resize",options:_objectSpread$4(_objectSpread$4({},t.options),{},{instanceId:e.app.instanceId})})}},{key:"get",value:function(t,e){var r=e.app,n=this.adapter.instances;return this.adapter.Promise.resolve(n.filter((function(t){return t.id===r.id})).map((function(t){return{instanceId:t.instanceId,location:t.location,parentId:t.parentId}})))}},{key:"send",value:function(t,e){var r=e.app,n=this.adapter.instances,a={service:t.service,data:t.options.message,event:"message"},o=null;return o=t.receiver&&0!==t.receiver.length?findReceivers(r,t.receiver):r.isModal?findParentOf(r):findModalOf(r),n.filter(o).forEach((function(t){return t.postMessage(a)})),this.adapter.Promise.resolve({})}},{key:"context",value:function(t,e){var r=e.app;return this.adapter.Promise.resolve({instanceId:r.instanceId,location:r.location,parentId:r.parentId,data:r.data||{}})}},{key:"process",value:function(t,e){return"function"==typeof this[t.method]?this[t.method](t,e):this.adapter.Promise.reject({message:INVALID_METHOD$1})}}]),t}();function ownKeys$3(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$3(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys$3(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys$3(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var TEMPLATE_MISSING="Missing required Parameter 'template'",OAUTH_TOKEN_REMOVE_SUCCESS="OAuth Tokens removed successfully",NO_TOKENS_FOUND="No OAuth tokens were found",InterfaceAPI=function(){function t(e){_classCallCheck(this,t),this.adapter=e,this.isProductAPI=!0}return _createClass(t,[{key:"process",value:function(t,e){var r=e.app;if("resetOauth"===t.method)return hasOAuthTokens(r)?(clearOAuthTokens(r),this.adapter.Promise.resolve({message:OAUTH_TOKEN_REMOVE_SUCCESS})):this.adapter.Promise.reject({message:NO_TOKENS_FOUND});if(!this.adapter.overlays.includes(t.method))return this.adapter.interface(t);if(!t.options.hasOwnProperty("template"))return this.adapter.Promise.reject({message:TEMPLATE_MISSING});var n="".concat(r.url.substring(0,r.url.lastIndexOf("/")),"/").concat(t.options.template),a=new AppInstance(_objectSpread$3(_objectSpread$3({},r.appDetails),{},{url:n,data:t.options.data,parentId:r.instanceId,isModal:!0}),"overlay",r.services,{product:this.adapter.product,Promise:this.adapter.Promise,locations:this.adapter.locations});return this.adapter.instances.push(a.appInstance),this.adapter.interface(_objectSpread$3(_objectSpread$3({},t),{},{instance:a}))}}]),t}();function ownKeys$2(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$2(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys$2(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys$2(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var DatastoreAPI=function(){function t(e){_classCallCheck(this,t),this.adapter=e,this.configs=initialize(e)}return _createClass(t,[{key:"process",value:function(t,e){var r=this,n=e.app.isLocal?"".concat(e.app.protocol,"://").concat(this.configs.urls.LOCAL_DATA_PIPE):this.configs.urls.DATA_PIPE,a=t.options.route||"db";delete t.options.route;var o=_objectSpread$2(_objectSpread$2({},t.options),{},{action:t.method,isInstall:this.adapter.isInstall});return this.adapter.ajax({url:n,type:"POST",timeout:this.configs.timeouts.DATA,data:JSON$1.stringify(o),headers:{"X-REQUEST-ID":uuidv4(),"MKP-APIKEY":this.adapter.apiKey,"MKP-AUTH-TOKEN":this.adapter.authToken,"X-CSRF-TOKEN":this.adapter.csrfToken,"content-type":"application/json","MKP-EXTNID":e.app.id,"MKP-VERSIONID":e.app.versionId,"MKP-ROUTE":a}}).then((function(t){return r.adapter.Promise.resolve(t)}),(function(t){return r.adapter.Promise.reject(JSON$1.parse(t.responseText))}))}}]),t}();function ownKeys$1(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread$1(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys$1(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys$1(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var TIMEOUT_ERROR="Request timed out!",INVALID_METHOD="Invalid method provided.",UNEXPECTED_RESPONSE="Received unexpected response from client",VALID_METHODS=["getConfigs","postConfigs","validate"],SERVICE="CustomIparamAPI",VALIDATE="validate",TIMEOUT=5e3,CustomIparamAPI=function(){function t(e){_classCallCheck(this,t),this.adapter=e,this.requests={}}return _createClass(t,[{key:"process",value:function(t,e){var r=this;if(VALID_METHODS.indexOf(t.method)<0)return this.adapter.Promise.reject(INVALID_METHOD);var n=_objectSpread$1(_objectSpread$1({},t),{},{service:SERVICE,uniqId:generateId(),instanceId:e.app.instanceId});return new this.adapter.Promise((function(t,a){r.requests[n.uniqId]={resolve:t,reject:a},r.gc(n.uniqId),e.app.postMessage(n)}))}},{key:"responseHandler",value:function(t){if(this.requests[t.uniqId]){var e=this.requests[t.uniqId];return delete this.requests[t.uniqId],t.respData?t.method!==VALIDATE||t.respData.hasOwnProperty("isValid")&&t.respData.isValid?e.resolve(t.respData):e.reject(t.respData):e.reject({method:t.method,error:t.error})}return console.error("".concat(SERVICE," - ").concat(UNEXPECTED_RESPONSE),t)}},{key:"gc",value:function(t){var e=this;setTimeout((function(){e.requests[t]&&(e.requests[t].reject({message:TIMEOUT_ERROR}),delete e.requests[t])}),TIMEOUT)}}]),t}(),BAD_REQ_STATUS=400,ScheduleAPI=function(){function t(e){_classCallCheck(this,t),this.adapter=e,this.configs=initialize(e)}return _createClass(t,[{key:"process",value:function(t,e){var r=this,n=e.app.isLocal?"".concat(e.app.protocol,"://").concat(this.configs.urls.LOCAL_DATA_PIPE):this.configs.urls.DATA_PIPE,a={schedule_params:t.options,action:t.method,account_full_domain:getHostName(this.adapter.domain),isInstall:this.adapter.isInstall};return this.adapter.ajax({url:n,type:"POST",timeout:this.configs.timeouts.SCHEDULE,data:JSON$1.stringify(a),headers:{"X-REQUEST-ID":uuidv4(),"MKP-APIKEY":this.adapter.apiKey,"MKP-AUTH-TOKEN":this.adapter.authToken,"X-CSRF-TOKEN":this.adapter.csrfToken,"content-type":"application/json","MKP-EXTNID":e.app.id,"MKP-VERSIONID":e.app.versionId,"MKP-ROUTE":"schedule"}}).then((function(t){return t&&t.status&&t.status>=BAD_REQ_STATUS?r.adapter.Promise.reject(t):r.adapter.Promise.resolve(t)}),(function(t){return r.adapter.Promise.reject(t.response||t)}))}}]),t}();function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach((function(e){_defineProperty(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var SERVICES={DataAPI:DataAPI,EventAPI:EventAPI,IparamAPI:IparamAPI,RequestAPI:RequestAPI,InstanceAPI:InstanceAPI,InterfaceAPI:InterfaceAPI,DataStoreAPI:DatastoreAPI,CustomIparamAPI:CustomIparamAPI,ScheduleAPI:ScheduleAPI},CUSTOM_IPARAM="custom_iparam",MarketplaceManager=function(){function t(e){var r=this;_classCallCheck(this,t),validate("MarketplaceManager.adapter",e),this.configs=initialize(e),this.services={},this.channel="",this.isDev=-1!==window.location.search.indexOf("dev=true"),this.adapter=e,this.adapter.instances=[],this.adapter.apiTokenInstance=new ApiToken(this.adapter),Object.keys(SERVICES).forEach((function(t){r.services[t]=new SERVICES[t](r.adapter)}));var n=new galleryInstance(this);return window.addEventListener("message",(function(t){"gallery:initialize"===t.data?n.channel=t.ports[0]:onMessage(t,r.adapter,r.configs)}),!1),this.adapter.page===CUSTOM_IPARAM?{createInstance:function(t){var n=pick(r.services,(function(t,e){return!e.isProductAPI})),a=new AppInstance(_objectSpread(_objectSpread({},t),{},{protocol:t.protocol||"http",url:t.locations[CUSTOM_IPARAM].url,iconURL:t.locations[CUSTOM_IPARAM].icon_url,productConfigs:r.adapter.productConfigs,isInstall:r.adapter.isInstall}),CUSTOM_IPARAM,n,e);return r.adapter.instances.push(a.appInstance),a}}:{getApps:function(t){return r.getApps(t)},trigger:function(t){return r.services.EventAPI.route(t)},getMarketplaceViewerConfigs:function(){return r.getMarketplaceViewerConfigs()},getGallery:function(t){return n.getGallery(t)},getCollections:function(t){return r.getCollections(t)},getAppRecommendations:function(t){return r.getAppRecommendations(t)}}}var e;return _createClass(t,[{key:"getAppDetails",value:function(){return this.appDetails||(this.appDetails=this.adapter.Promise.all([this.makeCall(),this.makeCall(!0)]).then(flattenArray)),this.appDetails}},{key:"getCollections",value:function(t){var e="".concat(this.configs.urls.COLLECTION_APPS,"/").concat(t.name,"?account=").concat(this.adapter.accountID);return t.include&&(e+="&include=".concat(t.include)),this.adapter.ajax({method:"GET",headers:{"MKP-APIKEY":this.adapter.apiKey,accept:"application/json","X-CSRF-TOKEN":this.adapter.csrfToken,"MKP-AUTH-TOKEN":this.adapter.authToken},url:e})}},{key:"getAppRecommendations",value:function(t){var e="".concat(this.configs.urls.RECOMMENDATIONS_APPS,"?location=").concat(t);return this.adapter.ajax({method:"GET",headers:{Authorization:"Bearer ".concat(this.adapter.apiTokenInstance.getApiToken()),"Content-Type":"application/json"},url:e})}},{key:"getApps",value:function(t){var e=this;function r(e){return-1!==Object.keys(e.locations).indexOf(t.location)}if(!this.adapter.locations.hasOwnProperty(t.location))return this.adapter.Promise.resolve([]);return this.getAppDetails().then((function(n){var a,o=pick(e.services,(function(r,n){return!n.isProductAPI||e.adapter.locations[t.location].services.includes(r)})),i=n.filter(r).sort(t.sorter).map((function(r){return new AppInstance(_objectSpread(_objectSpread({},r),{},{url:r.locations[t.location].url,iconURL:r.locations[t.location].icon_url}),t.location,o,e.adapter)}));return(a=e.adapter.instances).push.apply(a,_toConsumableArray(i.map((function(t){return t.appInstance})))),i}))}},{key:"makeCall",value:(e=_asyncToGenerator(regenerator.mark((function t(e){var r,n,a,o,i=this;return regenerator.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e||this.isDev){t.next=2;break}return t.abrupt("return",[]);case 2:if(r="",!e){t.next=7;break}return t.next=6,checkProtocol(this.adapter.ajax);case 6:r=t.sent;case 7:return n=function(t){return e&&(t=normalizeCLIResponse(t,i.adapter.product,r),i.adapter.interface({method:"showNotify",options:{message:'FDK serving local app "'.concat(t.map((function(t){return t.displayName})),'"'),type:"info"}})),t.map((function(t){return{id:t.id,isLocal:!!e,protocol:r,features:t.features,versionId:t.version_id,configs:t.configs||{},locations:t.placeholders||{},displayName:t.displayName||t.display_name,authorizeUrl:t.authorizeUrl||t.authorize_url}}))},a=function(){return[]},o=function(){return i.isDev&&i.configs.urls.APP_LIST_WITH_TEST_VERSION?i.configs.urls.APP_LIST_WITH_TEST_VERSION:i.configs.urls.APP_LIST},t.abrupt("return",this.adapter.ajax({method:"GET",headers:{"MKP-APIKEY":this.adapter.apiKey,accept:"application/json","X-CSRF-TOKEN":this.adapter.csrfToken,"MKP-AUTH-TOKEN":this.adapter.authToken},url:e?"".concat(r,"://").concat(this.configs.urls.LOCAL_APP_LIST):o()}).then(n,a));case 11:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"getMarketplaceViewerConfigs",value:function(){return{galleryURL:this.adapter.galleryURL,isAdmin:!!this.adapter.isAdmin,domain:this.adapter.domain,pod:this.adapter.pod,product:this.adapter.product}}}]),t}(),GalleryEventReceiver=function(){function t(e){_classCallCheck(this,t),validate("EventReceiver.adapter",e),this.iframeId=e.iframeId,this.eventHandler="function"==typeof e.eventHandler?e.eventHandler:null,this.initialize()}return _createClass(t,[{key:"setupChannel",value:function(){this.channel||(this.channel=new MessageChannel,this.port=this.channel.port1,this.eventSource.contentWindow.postMessage("galleryIframe:port","*",[this.channel.port2]),this.port.addEventListener("message",this.onMessage.bind(this),!1),this.port.start())}},{key:"initialize",value:function(){var t=this;this.eventSource=document.getElementById(this.iframeId),this.eventSource&&this.eventSource.addEventListener&&this.eventSource.addEventListener("load",(function(){t.setupChannel()}))}},{key:"onMessage",value:function(t){this.eventHandler&&this.eventHandler(t.data)}},{key:"postMessage",value:function(t){this.port&&this.port.postMessage&&this.port.postMessage(t)}}]),t}(),Manager=_createClass((function t(e){return _classCallCheck(this,t),"galleryEventExchange"===e.type?new GalleryEventReceiver(e):new MarketplaceManager(e)}));window.MarketplaceManager=Manager})();
